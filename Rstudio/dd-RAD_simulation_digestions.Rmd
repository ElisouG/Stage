---
title: 'dd-RAD : Digestion in Silico'
author: "Elise GUERET"
date: "7 mai 2018"
output: html_document
---


```{r Installation des packages, eval=FALSE, cache=TRUE}
# From Bioconductor
if (!require(c(zlibbioc,Biostrings,ShortRead))){
  source("http://bioconductor.org/biocLite.R")
  biocLite()
  biocLite("Biostrings")
  biocLite("ShortRead")
  biocLite("zlibbioc")
}
# From CRAN
if (!require(SimRAD)) {
  install.packages("SimRAD")
  library("SimRAD")
}
```

# Lecture du Fasta de référence

```{r Fasta Reference}
FASTA.file <- "/home/elise.gueret/labrax.fa"
ref.DNAseq <- ref.DNAseq(FASTA.file, subselect.contigs = TRUE, prop.contigs = 0.1)
```

# Définition des sites de restriction

```{r Sites de restiction}
# PstI
cs_5p1 <- "CTGCA"
cs_3p1 <- "G"
# MseI
cs_5p2 <- "T"
cs_3p2 <- "TAA"
# EcoRI
cs_5p3 <- "G"
cs_3p3 <- "AATTC"
# MspI
cs_5p4 <- "C"
cs_3p4 <- "CGG"
```

# dd-RAD with PstI and MseI

## Digestion

```{r Simulation de la digestion 1}
simseq.dig1 <- insilico.digest(ref.DNAseq, cs_5p1, cs_3p1, cs_5p2, cs_3p2, verbose=TRUE)
```

## Sélection des fragments avec les 2 sites de restriction

```{r Simulation de la sélection 1}
simseq.sel1 <- adapt.select(simseq.dig1, type="AB+BA", cs_5p1, cs_3p1, cs_5p2, cs_3p2)
```

## Large sélection de taille

```{r Wide size selection 1}
wid.simseq1 <- size.select(simseq.sel1, min.size = 200, max.size = 400, graph=TRUE, verbose=TRUE)
```

## Petite sélection de taille

```{r Narrow size selection 1}
nar.simseq1 <- size.select(simseq.sel1, min.size = 210, max.size = 260, graph=TRUE, verbose=TRUE)
```

## Caractéristiques des fragments qui seront analysés

```{r Graph des sélections pour 1ère digestion}
boxplot(list(width(simseq.sel1), width(wid.simseq1), width(nar.simseq1)), names=c("All fragments",
"Wide size selection", "Narrow size selection"), ylab="Locus size (bp)")
```

# dd-RAD with EcoRI and MspI

## Digestion

```{r Simulation de la digestion 2}
simseq.dig2 <- insilico.digest(ref.DNAseq, cs_5p3, cs_3p3, cs_5p4, cs_3p4, verbose=TRUE)
```

## Sélection des fragments avec les 2 sites de restriction

```{r Simulation de la sélection 2}
simseq.sel2 <- adapt.select(simseq.dig2, type="AB+BA", cs_5p3, cs_3p3, cs_5p4, cs_3p4)
```

## Large sélection de taille

```{r Wide size selection 2}
wid.simseq2 <- size.select(simseq.sel2, min.size = 200, max.size = 400, graph=TRUE, verbose=TRUE)
```

## Petite sélection de taille

```{r Narrow size selection 2}
nar.simseq2 <- size.select(simseq.sel2, min.size = 210, max.size = 260, graph=TRUE, verbose=TRUE)
```

## Caractéristiques des fragments qui seront analysés

```{r Graph des sélections pour 2nde digestion}
boxplot(list(width(simseq.sel2), width(wid.simseq2), width(nar.simseq2)), names=c("All fragments",
"Wide size selection", "Narrow size selection"), ylab="Locus size (bp)")
```

# dd-RAD with EcoRI and MseI

## Digestion

```{r Simulation de la digestion 3}
simseq.dig3 <- insilico.digest(ref.DNAseq, cs_5p3, cs_3p3, cs_5p2, cs_3p2, verbose=TRUE)
```

## Sélection des fragments avec les 2 sites de restriction

```{r Simulation de la sélection 3}
simseq.sel3 <- adapt.select(simseq.dig3, type="AB+BA", cs_5p3, cs_3p3, cs_5p2, cs_3p2)
```

## Large sélection de taille

```{r Wide size selection 3}
wid.simseq3 <- size.select(simseq.sel3, min.size = 200, max.size = 400, graph=TRUE, verbose=TRUE)
```

## Petite sélection de taille

```{r Narrow size selection 3}
nar.simseq3 <- size.select(simseq.sel3, min.size = 210, max.size = 260, graph=TRUE, verbose=TRUE)
```

## Caractéristiques des fragments qui seront analysés

```{r Graph des sélections pour 3ème digestion}
boxplot(list(width(simseq.sel3), width(wid.simseq3), width(nar.simseq3)), names=c("All fragments",
"Wide size selection", "Narrow size selection"), ylab="Locus size (bp)")
```

# dd-RAD with EcoRI and PstI

## Digestion

```{r Simulation de la digestion 4}
simseq.dig4 <- insilico.digest(ref.DNAseq, cs_5p3, cs_3p3, cs_5p1, cs_3p1, verbose=TRUE)
```

## Sélection des fragments avec les 2 sites de restriction

```{r Simulation de la sélection 4}
simseq.sel4 <- adapt.select(simseq.dig4, type="AB+BA", cs_5p3, cs_3p3, cs_5p1, cs_3p1)
```

## Large sélection de taille

```{r Wide size selection 4}
wid.simseq4 <- size.select(simseq.sel4, min.size = 200, max.size = 400, graph=TRUE, verbose=TRUE)
```

## Petite sélection de taille

```{r Narrow size selection 4}
nar.simseq4 <- size.select(simseq.sel4, min.size = 210, max.size = 260, graph=TRUE, verbose=TRUE)
```

## Caractéristiques des fragments qui seront analysés

```{r Graph des sélections pour 4ème digestion}
boxplot(list(width(simseq.sel4), width(wid.simseq4), width(nar.simseq4)), names=c("All fragments",
"Wide size selection", "Narrow size selection"), ylab="Locus size (bp)")
```